# 3.3.5  Command

## 1. Introdu√ß√£o

Este documento apresenta a aplica√ß√£o do padr√£o de projeto comportamental Command, um dos GoF Comportamentais, no contexto do sistema de trocas e vendas entre alunos. 

A utiliza√ß√£o do padr√£o Command neste projeto visa encapsular opera√ß√µes do dom√≠nio, como publica√ß√£o, edi√ß√£o, remo√ß√£o e altera√ß√£o de status de produtos, em objetos de comando independentes, permitindo maior flexibilidade, desacoplamento entre interface e l√≥gica de neg√≥cio e suporte a funcionalidades como hist√≥rico de a√ß√µes, execu√ß√£o em fila e possibilidade de desfazer opera√ß√µes (REFACTORING GURU, 2025).

## 2. Metodologia

A escolha do padr√£o Command se justifica pela necessidade de desacoplar a execu√ß√£o das opera√ß√µes da sua solicita√ß√£o, permitindo maior flexibilidade e clareza na estrutura do c√≥digo. Essa abordagem tamb√©m possibilita registrar hist√≥rico de a√ß√µes, executar comandos de forma sequencial e, futuramente, implementar mecanismos de desfazer opera√ß√µes, caso necess√°rio (SERRANO, 2025).

Com base nessa estrat√©gia, foram implementadas classes espec√≠ficas para cada tipo de comando, al√©m de um invocador respons√°vel por gerenciar a execu√ß√£o e o armazenamento das a√ß√µes realizadas dentro do sistema AquiTemFCTE.

- Utiliza√ß√£o do diagrama de classes, que serviu como base para estruturar os elementos envolvidos no padr√£o, suas rela√ß√µes e hierarquias.
- Foram utilizados os materiais fornecidos pela professora para o desenvolvimento do t√≥pico, como slides, videoaulas e exemplo de implementa√ß√£o em Java (SERRANO, 2025).
- O diagrama mostrado a seguir foi modelado atrav√©s da ferramenta draw.io, o que auxiliou diretamente na visualiza√ß√£o clara da composi√ß√£o dos objetos, seus relacionamentos e hierarquia.
- A implementa√ß√£o foi realizada com `Typescript`, por ser uma linguagem orientada a objetos.

## 3. Participantes

Os participantes da implementa√ß√£o deste Padr√£o de Projeto est√£o descritos na tabela abaixo:

<p style="text-align: center;">Tabela 1: Participantes da implementa√ß√£o do Command</p>

|Matr√≠cula | Aluno |
| -- | -- |
| 23/1026302  |  Caio Sabino  |
| 23/1011328  |  Felipe Campelo        |

## 4. Diagrama√ß√£o

<p align="center"><small>Figura 1 - Diagrama de Classes do Padr√£o Command.</small></p>

![Diagrama Command](../assets/Diagrama_Command.png)

<p align="center"><small>Fonte: Caio Sabino e Felipe Campelo.</small></p>

## 5. Desenvolvimento

O objetivo principal √© encapsular todos os dados necess√°rios para executar uma a√ß√£o em um √∫nico objeto (REFACTORING GURU, 2025).

Essa abordagem resolve um problema muito comum: ela desacopla o objeto que solicita uma a√ß√£o do objeto que sabe como executar essa a√ß√£o.


### Principais benef√≠cios implementados

1. **Desacoplamento:** o `PublicacaoInvoker` n√£o possui conhecimento sobre o `PublicacaoService`. Ele apenas sabe como executar ou desfazer comandos.  
2. **Encapsulamento:** cada comando (`CriarPublicacaoCommand`, `AtualizarPublicacaoCommand`) cont√©m todas as informa√ß√µes necess√°rias para sua execu√ß√£o, incluindo refer√™ncia ao servi√ßo e os dados relevantes (aluno, produto, status, etc.).  

### Os Participantes do Padr√£o 

Vamos analisar como cada arquivo se encaixa nesse padr√£o:

* **Command (Interface):** `Command.ts`
* **ConcreteCommand (Comandos Concretos):** `CriarPublicacaoCommand.ts`, `AtualizarPublicacaoCommand.ts`, `RemoverPublicacaoCommand.ts`
* **Receiver (Receptor):** `PublicacaoService.ts` 
* **Invoker (Invocador):** `PublicacaoInvoker.ts` 
* **Client (Cliente):** `main.ts` 
* **Modelos:** `Aluno.ts`, `Produto.ts`, `Publicacao.ts`, `enums.ts` 

### Estrutura das pastas
```sql
GOFs/
‚îî‚îÄ‚îÄ Comportamental/
    ‚îî‚îÄ‚îÄ Command/
        ‚îú‚îÄ‚îÄ commands/
        ‚îÇ   ‚îú‚îÄ‚îÄ CriarPublicacaoCommand.ts
        ‚îÇ   ‚îú‚îÄ‚îÄ AtualizarPublicacaoCommand.ts
        ‚îÇ   ‚îî‚îÄ‚îÄ RemoverPublicacaoCommand.ts
        ‚îú‚îÄ‚îÄ invoker/
        ‚îÇ   ‚îî‚îÄ‚îÄ PublicacaoInvoker.ts
        ‚îú‚îÄ‚îÄ services/
        ‚îÇ   ‚îî‚îÄ‚îÄ PublicacaoService.ts
        ‚îú‚îÄ‚îÄ models/
        ‚îÇ   ‚îú‚îÄ‚îÄ Aluno.ts
        ‚îÇ   ‚îú‚îÄ‚îÄ Produto.ts
        ‚îÇ   ‚îú‚îÄ‚îÄ Publicacao.ts
        ‚îÇ   ‚îî‚îÄ‚îÄ enums.ts
        ‚îú‚îÄ‚îÄ main.ts
        ‚îú‚îÄ‚îÄ package.json
        ‚îî‚îÄ‚îÄ tsconfig.json

```

[Clique aqui para acessar o c√≥digo no reposit√≥rio](https://github.com/UnBArqDsw2025-2-Turma02/2025.2_T02_G6_AquiTemFCTE_Entrega_03/tree/main/GOFs/Comportamental/Command)

### Models

Essa pasta representa os dados da aplica√ß√£o, utilizados segundo o diagrama de classes. Eles s√£o essenciais para o desenvolvimento do Command. O enum √© utilizado para o status da publica√ß√£o, que pode ser alterado atrav√©s de comandos.

#### Aluno

```typescript
// models/Aluno.ts
import {Produto} from "./Produto";

export class Aluno{
    constructor(public nome: string, public email: string){}

    publicarProduto(produto: Produto): void{
        console.log(`${this.nome} publicou o produto ${produto.nome}`);
    }
}
```
#### Produto
```typescript
// models/Produto.ts
export class Produto{
    constructor(public nome: string, public preco: number, public descricao: string){};
}
```

#### Publica√ß√£o
```typescript
// models/Publicacao.ts
import {Produto} from "./Produto";
import {Aluno} from "./Aluno";
import { StatusEnum } from "./enums";

export class Publicacao{
    private status: StatusEnum;

    constructor(public produto: Produto, public aluno: Aluno){
        this.status = StatusEnum.Disponivel;
    }

    mudarStatus(status: StatusEnum): void{
        this.status = status;
        console.log(`Status da publica√ß√£o do aluno ${this.aluno.nome} do produto
            ${this.produto.nome} agora √© ${status}`);
    }

    getStatus(): StatusEnum{
        return this.status;
    }
}
```
#### Enum
```typescript
// models/enums.ts
export enum StatusEnum {
    Disponivel = "Dispon√≠vel",
    Indisponivel = "Indispon√≠vel",
}
```

### Receiver

A classe Receiver executa as a√ß√µes de neg√≥cio, comandado pela classe Command.


#### PublicacaoService
```typescript

// services/PublicacaoService.ts
import { Aluno } from "../models/Aluno";
import { Produto } from "../models/Produto";
import { Publicacao } from "../models/Publicacao";
import { StatusEnum } from "../models/enums";

export class PublicacaoService {
  private publicacoes: Publicacao[] = [];

  criarPublicacao(aluno: Aluno, produto: Produto): Publicacao {
    const publicacao = new Publicacao(produto, aluno);
    this.publicacoes.push(publicacao);
    aluno.publicarProduto(produto);
    console.log("‚úÖ Publica√ß√£o criada com sucesso!");
    return publicacao;
  }

  atualizarPublicacao(publicacao: Publicacao, novoStatus: StatusEnum): void {
    publicacao.mudarStatus(novoStatus);
    console.log("üîÑ Publica√ß√£o atualizada!");
  }

  removerPublicacao(publicacao: Publicacao): void {
    publicacao.mudarStatus(StatusEnum.Indisponivel);
    console.log("‚ùå Publica√ß√£o removida!");
  }
}
```

### Command

Esta √© a parte central do padr√£o. Inclui a Interface Command, que define um contrato, e os Concrete Commands, que encapsulam uma solicita√ß√£o espec√≠fica.

- O Command.ts √© a interface que padroniza todas as execu√ß√µes nos m√©todos `execute()` e `undo()`.
- As outras classes presentes na mesma pasta s√£o os Concrete Commands, que tem como fun√ß√£o encapsular uma solicita√ß√£o.

#### Command
```typescript
// commands/Command.ts
export interface Command {
  execute(): void;
  undo(): void; // opcional, mas √∫til em sistemas reais
}
```
#### AtualizarPublicacaoCommand
```typescript
// commands/AtualizarPublicacaoCommand.ts
import { Command } from "./Command";
import { PublicacaoService } from "../services/PublicacaoService";
import { Publicacao } from "../models/Publicacao";
import { StatusEnum } from "../models/enums";

export class AtualizarPublicacaoCommand implements Command {
  constructor(
    private service: PublicacaoService,
    private publicacao: Publicacao,
    private novoStatus: StatusEnum
  ) {}

  execute(): void {
    this.service.atualizarPublicacao(this.publicacao, this.novoStatus);
  }

  undo(): void {
    this.service.atualizarPublicacao(this.publicacao, StatusEnum.Disponivel);
    console.log("‚Ü©Ô∏è A√ß√£o desfeita: status voltou para dispon√≠vel.");
  }
}
```
#### CriarPublicacaoCommand
```typescript
// commands/CriarPublicacaoCommand.ts
import { Command } from "./Command";
import { PublicacaoService } from "../services/PublicacaoService";
import { Aluno } from "../models/Aluno";
import { Produto } from "../models/Produto";
import { Publicacao } from "../models/Publicacao";

export class CriarPublicacaoCommand implements Command {
  private publicacao?: Publicacao;

  constructor(
    private service: PublicacaoService,
    private aluno: Aluno,
    private produto: Produto
  ) {}

  execute(): void {
    this.publicacao = this.service.criarPublicacao(this.aluno, this.produto);
  }

  undo(): void {
    if (this.publicacao) {
      this.service.removerPublicacao(this.publicacao);
      console.log("‚Ü©Ô∏è A√ß√£o desfeita: publica√ß√£o removida.");
    }
  }
}
```
#### RemoverPublicacaoCommand
```typescript
// commands/RemoverPublicacaoCommand.ts
import { Command } from "./Command";
import { PublicacaoService } from "../services/PublicacaoService";
import { Publicacao } from "../models/Publicacao";

export class RemoverPublicacaoCommand implements Command {
  constructor(private service: PublicacaoService, private publicacao: Publicacao) {}

  execute(): void {
    this.service.removerPublicacao(this.publicacao);
  }

  undo(): void {
    console.log("‚Ü©Ô∏è (Simula√ß√£o) Publica√ß√£o restaurada!");
  }
}
```

### Invoker

O Invoker √© o objeto que dispara a a√ß√£o. Ele √© associado a um comando e o executa. Ele n√£o sabe o que o comando faz, apenas como execut√°-lo.

### PublicacaoInvoker

```typescript
// invoker/PublicacaoInvoker.ts
import { Command } from "../commands/Command";

export class PublicacaoInvoker {
  private historico: Command[] = [];

  executar(command: Command): void {
    command.execute();
    this.historico.push(command);
  }

  desfazerUltimo(): void {
    const ultimo = this.historico.pop();
    if (ultimo) ultimo.undo();
  }
}
```

### Cliente

Essa classe define qual comando executar e quando, foi utilizada como classe de teste.


#### Main
```typescript
// main.ts
import { Aluno } from "./models/Aluno";
import { Produto } from "./models/Produto";
import { PublicacaoService } from "./services/PublicacaoService";
import { CriarPublicacaoCommand } from "./commands/CriarPublicacaoCommand";
import { AtualizarPublicacaoCommand } from "./commands/AtualizarPublicacaoCommand";
import { RemoverPublicacaoCommand } from "./commands/RemoverPublicacaoCommand";
import { PublicacaoInvoker } from "./invoker/PublicacaoInvoker";
import { StatusEnum } from "./models/enums";

// Simula o fluxo do app
const aluno = new Aluno("Caio", "caio@email.com");
const produto = new Produto("Viol√£o", 500, "Instrumento usado");
const service = new PublicacaoService();
const invoker = new PublicacaoInvoker();

//  Criar publica√ß√£o
const criarCmd = new CriarPublicacaoCommand(service, aluno, produto);
invoker.executar(criarCmd);

//  Atualizar status
const publicacao = service["publicacoes"][0];
const atualizarCmd = new AtualizarPublicacaoCommand(service, publicacao, StatusEnum.Indisponivel);
invoker.executar(atualizarCmd);

//  Remover publica√ß√£o
const removerCmd = new RemoverPublicacaoCommand(service, publicacao);
invoker.executar(removerCmd);

//  Desfazer √∫ltima a√ß√£o
invoker.desfazerUltimo();
```

### Como executar o c√≥digo?

#### Passo 1: Acesse o diret√≥rio do Projeto:

```shell
cd GOFs/Comportamentais/Command
```

#### Passo 2: Instale as depend√™ncias do Projeto:

```shell
npm install 
```

#### Passo 3: Execute o projeto:

```shell
npm start
```


## 6. V√≠deo do c√≥digo rodando

<p align="center"><small>V√≠deo 1 - C√≥digo Command (Fonte: Caio Sabino).</small></p>

<div align="center">
  <iframe 
    width="560" 
    height="315" 
    src="https://www.youtube.com/embed/7hXbFJShbik" 
    title="Command - AquiTemFCTE" 
    frameborder="0" 
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
    allowfullscreen>
  </iframe>
</div>


## 7. Senso Cr√≠tico e Trabalho em Equipe

### Justificativas e Senso Cr√≠tico

Foi feita uma an√°lise detalhada do projeto para projetar a viabilidade da aplica√ß√£o desse padr√£o de projeto no AquiTemFCTE, pois este, por muitas vezes, n√£o se encaixa em alguns projetos por sua complexidade. Essa an√°lise foi essencial para entendermos como esse design pattern √© importante e o quanto ele facilita a implementa√ß√£o e entendimento do projeto.




## 8. Conclus√£o

Em conclus√£o, a aplica√ß√£o do padr√£o Command no projeto foi eficaz ao transformar solicita√ß√µes de neg√≥cios em objetos independentes.

O principal benef√≠cio alcan√ßado foi o desacoplamento entre a camada que inicia a a√ß√£o e a camada que executa a l√≥gica de neg√≥cios.

Essa arquitetura n√£o apenas tornou o c√≥digo mais flex√≠vel, mas tamb√©m viabilizou, de forma natural, a implementa√ß√£o de funcionalidades complexas, como um hist√≥rico de a√ß√µes e a capacidade de desfazer, que foram centralizadas no Invocador. A simula√ß√£o final validou como esses componentes interagem de forma coesa, permitindo a execu√ß√£o e a revers√£o de opera√ß√µes.

## 9. Refer√™ncias

> REFACTORING GURU. **Command design pattern**. Dispon√≠vel em: https://refactoring.guru/design-patterns/command. Acesso em: 23 out. 2025.

> SERRANO, Milene, Arquitetura e Desenho de Software - Aula - GOFS Comportamentais. Dispon√≠vel em: https://aprender3.unb.br/pluginfile.php/3178544/mod_page/content/1/Arquitetura%20e%20Desenho%20de%20Software%20-%20Aula%20GoFs%20Estruturais%20-%20Profa.%20Milene.pdf. Universidade de Bras√≠lia - UnB. Bras√≠lia. Acesso em 23 de outubro de 2025.

## Hist√≥rico de Vers√µes

| Vers√£o | Data       | Descri√ß√£o                              | Autor(es)                                           | Revisor(es)                                         | Detalhes da Revis√£o                      |
| ------ | ---------- | -------------------------------------- | --------------------------------------------------- | --------------------------------------------------- | ---------------------------------------- |
| 1.0    | 23/10/2025 | In√≠cio documenta√ß√£o                   | [Felipe Campelo](https://github.com/felipeacampelo) | [Caio Sabino](https://github.com/caiomsabino) |Adicionar o resto das coisas. |
| 1.1   | 23/10/2025 | Refatora√ß√£o da documenta√ß√£o, inser√ß√£o dos c√≥digos e inser√ß√£o de v√≠deo. | [Caio Sabino](https://github.com/caiomsabino) | [Felipe Campelo](https://github.com/felipeacampelo) | Adicionar diagrama |
| 1.2   | 23/10/2025 | Adiciona diagrama e refer√™ncias | [Felipe Campelo](https://github.com/felipeacampelo) | [Caio Sabino](https://github.com/caiomsabino) | |
