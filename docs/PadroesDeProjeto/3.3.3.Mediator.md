# 3.3.3. Mediator

## **1. Padrão GOF Mediator**

O **Mediator** (Mediador em português), categorizado como um padrão **comportamental** pela Gang of Four (GoF), permite reduzir as dependências caóticas entre objetos. O padrão restringe comunicações diretas entre objetos e os força a colaborar apenas através do objeto mediador (REFACTORING GURU, 2025).

Neste projeto, o padrão foi aplicado sobre o **Login**, o **Cadastro** e a **Autenticação**, implementando a lógica da existência de um mediador que direciona as comunicações entre os componentes, pois, ao utilizar essa ideia, o sistema se torna mais organizado, e fácil de manutenir, expandir e compreender.

## **2. Metodologia**

A metodologia desse artefato seguiu as seguintes etapas:

**1.** Análise do diagrama de classes e pacotes: Após o estudo do conteúdo, o diagrama de classes e de pacotes, produzidos anteriormente, foram analisados pelos integrantes com a intenção de identificar onde o padrão GoF Mediator poderia ser aplicado, já considerando o refinamento feito sobre eles.

**2.** Elaboração do diagrama: Após decidido pelos integrantes responsáveis que as classes a serem trabalhadas seriam a de Login e a de Cadastro, foi produzido o diagrama, com a ferramenta [draw.io](https://www.drawio.com/), considerando os princípios do Mediator, tal como as necessidades do projeto.

**3.** Desenvolvimento do código: Considerando o diagrama elaborado, foi feita a implementação do código de maneira compreensível e organizada no sistema a ser detalhado posteriormente.

**4.** Testes de execução do Mediator: Após a implementação do código, foram realizados testes para validar a aplicação do GoF ao projeto nas classes de Login e de Cadastro.

**5.** Documentação do artefato: Durante todo o desenvolvimento das etapas anteriores, os membros documentaram e aprimoraram as informações obtidas, formalizando o processo.

## 3. Participantes

Os participantes da implementação deste Padrão de Projeto estão descritos na tabela abaixo:

<p style="text-align: center;">Tabela 1: Participantes da implementação do Mediator</p>

|Matrícula | Aluno |
| -- | -- |
| 23/1011220  |  Davi Camilo       |
| 22/2015159  |  Lucas Guimarães   |

## **4. Modelagem do Mediator**

<font size="2"><p style="text-align: center"><b>Figura 1:</b> Diagrama do Mediator</p></font>

![diagrama_mediator](/../assets/gof-mediator.drawio.png)

<font size="2"><p style="text-align: center"><b>Fonte:</b> Davi Camilo e Lucas Guimarães</p></font>

## 5. Vídeo

<font size="2"><p style="text-align: center"><b>Vídeo 1:</b> Explicação e execução do Mediator</p></font>

<center>
  <iframe
    width="560"
    height="315"
    src="https://www.youtube.com/embed/ZSsfIMUWgKc"
    title="Mediator - AquiTemFCTE"
    frameborder="0"
    allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
    allowfullscreen>
  </iframe>
</center>


<font size="2"><p style="text-align: center"><b>Autor:</b> [Lucas Guimarães](https://github.com/lcsgborges), 2025.</p></font>

**Link: https://youtu.be/ZSsfIMUWgKc**

## **6. Informações Técnicas e Implementação**

A estrutura implementada pode ser vista abaixo:

### 6.1. Classe Mediator

*`mediators/mediator.ts`*

```typescript
export interface Mediator {
    notify(sender: object, event: string, data?: any): void;
}
```

### 6.2. Classe ComponentForm

*`forms/componentForm.ts`*

```typescript
import { Mediator } from "../mediators/mediator";

export abstract class ComponentForm {
    protected mediator?: Mediator;

    setMediator(mediator: Mediator) {
        this.mediator = mediator;
    }

    abstract submit(): void;
}
```

### 6.3. Classe LoginForm

*`forms/loginForm.ts`*

```typescript
import { ComponentForm } from "./componentForm";
import { Mediator } from "../mediators/mediator";

export class LoginForm extends ComponentForm {
    private fields = { 
        email: "", 
        password: "" 
    };

    constructor(mediator: Mediator) {
        super();
        this.mediator = mediator;
    }

    setField(name: keyof typeof this.fields, value: string): void {
        this.fields[name] = value;
    }

    getFields() {
        return { ...this.fields };
    }

    submit(): void {
        console.log("Iniciando processo de login...");
        this.mediator?.notify(this, "login_attempt", this.getFields());
    }
}
```

### 6.4. Classe RegisterForm

*`forms/registerForm.ts`*

```typescript
import { ComponentForm } from "./componentForm";
import { Mediator } from "../mediators/mediator";

export class RegisterForm extends ComponentForm {
    private fields = {
        name: "",
        email: "",
        enrollment: "",
        password: "",
        confirmPassword: "",
        profilePhoto: null as File | null,
        enrollmentProof: null as File | null
    };

    constructor(mediator: Mediator) {
        super();
        this.mediator = mediator;
    }

    setField(name: keyof typeof this.fields, value: string | File): void {
        if (name === "profilePhoto" || name === "enrollmentProof") {
            this.fields[name] = value as File;
        } else {
            this.fields[name] = value as string;
        }
    }

    getFields() {
        return { ...this.fields };
    }

    submit(): void {
        console.log("Iniciando processo de cadastro...");
        this.mediator?.notify(this, "register_attempt", this.getFields());
    }
}
```

### 6.5. Classe ValidatorForm

*`forms/validatorForm.ts`*

```typescript
import { ComponentForm } from "./componentForm";
import { Mediator } from "../mediators/mediator";

export class ValidatorForm extends ComponentForm {
    constructor(mediator?: Mediator) {
        super();
        this.mediator = mediator;
    }

    validateLogin(fields: { email: string; password: string }): boolean {
        const errors: string[] = [];

        if (!fields.email) {
            errors.push("Email é obrigatório");
        } else if (!this.isValidEmail(fields.email)) {
            errors.push("Email inválido");
        }

        if (!fields.password) {
            errors.push("Senha é obrigatória");
        } else if (fields.password.length < 6) {
            errors.push("Senha deve ter no mínimo 6 caracteres");
        }

        if (errors.length > 0) {
            this.mediator?.notify(this, "validation_failed", { errors });
            return false;
        }

        this.mediator?.notify(this, "validation_success", {});
        return true;
    }

    validateRegister(fields: {
        name: string;
        email: string;
        enrollment: string;
        password: string;
        confirmPassword: string;
        profilePhoto: File | null;
        enrollmentProof: File | null;
    }): boolean {
        const errors: string[] = [];

        if (!fields.name || fields.name.trim().length < 3) {
            errors.push("Nome deve ter no mínimo 3 caracteres");
        }

        if (!fields.email) {
            errors.push("Email institucional é obrigatório");
        } else if (!this.isUnBEmail(fields.email)) {
            errors.push("Email deve ser institucional da UnB");
        }

        if (!fields.enrollment || fields.enrollment.length < 8) {
            errors.push("Matrícula inválida");
        }

        if (!fields.password) {
            errors.push("Senha é obrigatória");
        } else if (fields.password.length < 6) {
            errors.push("Senha deve ter no mínimo 6 caracteres");
        }

        if (fields.password !== fields.confirmPassword) {
            errors.push("As senhas não coincidem");
        }

        if (fields.profilePhoto && !this.isValidImageFile(fields.profilePhoto)) {
            errors.push("Foto de perfil deve ser uma imagem válida");
        }

        if (!fields.enrollmentProof) {
            errors.push("Comprovante de matrícula é obrigatório");
        } else if (!this.isValidDocumentFile(fields.enrollmentProof)) {
            errors.push("Comprovante deve ser PDF ou imagem");
        }

        if (errors.length > 0) {
            this.mediator?.notify(this, "validation_failed", { errors });
            return false;
        }

        this.mediator?.notify(this, "validation_success", {});
        return true;
    }

    public submit(..._args: any[]): void {
        this.mediator?.notify(this, "submit", {});
    }

    private isValidEmail(email: string): boolean {
        const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        return emailRegex.test(email);
    }

    private isUnBEmail(email: string): boolean {
        return email.endsWith("@unb.br") || email.endsWith("@aluno.unb.br");
    }

    private isValidImageFile(file: File): boolean {
        const validTypes = ["image/jpeg", "image/png", "image/jpg"];
        return validTypes.includes(file.type);
    }

    private isValidDocumentFile(file: File): boolean {
        const validTypes = ["application/pdf", "image/jpeg", "image/png", "image/jpg"];
        return validTypes.includes(file.type);
    }
}
```

### 6.6. Classe AuthMediator

*`mediators/authMediator.ts`*

```typescript
import { Mediator } from "./mediator";
import { LoginForm } from "../forms/loginForm";
import { RegisterForm } from "../forms/registerForm";
import { ValidatorForm } from "../forms/validatorForm";

export class AuthMediator implements Mediator {
    private loginForm?: LoginForm;
    private registerForm?: RegisterForm;
    private validator: ValidatorForm;

    constructor() {
        this.validator = new ValidatorForm(this);
    }

    setLoginForm(form: LoginForm): void {
        this.loginForm = form;
        this.loginForm.setMediator(this);
    }

    setRegisterForm(form: RegisterForm): void {
        this.registerForm = form;
        this.registerForm.setMediator(this);
    }

    notify(sender: object, event: string, data?: any): void {
        if (event === "login_attempt") {
            console.log("Validando credenciais de login...");
            const isValid = this.validator.validateLogin(data);
            if (isValid) {
                this.processLogin(data);
            }
        }

        if (event === "register_attempt") {
            console.log("Validando dados de cadastro...");
            const isValid = this.validator.validateRegister(data);
            if (isValid) {
                this.processRegister(data);
            }
        }

        if (event === "validation_success") {
            console.log("Validacao concluida com sucesso");
        }

        if (event === "validation_failed") {
            console.log("Falha na validacao:", data.errors);
            this.showErrors(data.errors);
        }
    }

    private processLogin(credentials: { email: string; password: string }): void {
        console.log("Processando login para:", credentials.email);
        // Aqui entraria a logica de autenticacao real (API)
    }

    private processRegister(userData: {
        name: string;
        email: string;
        enrollment: string;
        password: string;
        confirmPassword: string;
        profilePhoto: File | null;
        enrollmentProof: File | null;
    }): void {
        console.log("Processando cadastro para:", userData.name);
        // Aqui entraria a logica de registro real (API)
    }

    private showErrors(errors: string[]): void {
        console.log("Erros de validacao:");
        errors.forEach(error => console.log(`- ${error}`));
    }
}
```

### 6.7. Código de testes

<details>
  <summary>Clique aqui para ver o código inteiro dos testes</summary>
  

```typescript

import { AuthMediator } from "./mediators/authMediator";
import { LoginForm } from "./forms/loginForm";
import { RegisterForm } from "./forms/registerForm";

console.log("=== INICIANDO TESTES DO MEDIATOR ===\n");

// Criar o mediator e os formularios
const mediator = new AuthMediator();
const loginForm = new LoginForm(mediator);
const registerForm = new RegisterForm(mediator);

mediator.setLoginForm(loginForm);
mediator.setRegisterForm(registerForm);

console.log("--- TESTE 1: Login valido ---");
loginForm.setField("email", "aluno@unb.br");
loginForm.setField("password", "senha123");
loginForm.submit();
console.log("");

console.log("--- TESTE 2: Login com email invalido ---");
const loginForm2 = new LoginForm(mediator);
mediator.setLoginForm(loginForm2);
loginForm2.setField("email", "email-invalido");
loginForm2.setField("password", "senha123");
loginForm2.submit();
console.log("");

console.log("--- TESTE 3: Login com senha curta ---");
const loginForm3 = new LoginForm(mediator);
mediator.setLoginForm(loginForm3);
loginForm3.setField("email", "aluno@unb.br");
loginForm3.setField("password", "123");
loginForm3.submit();
console.log("");

console.log("--- TESTE 4: Login com campos vazios ---");
const loginForm4 = new LoginForm(mediator);
mediator.setLoginForm(loginForm4);
loginForm4.submit();
console.log("");

console.log("--- TESTE 5: Cadastro valido ---");
const mockFile = new File(["conteudo"], "comprovante.pdf", { type: "application/pdf" });
registerForm.setField("name", "Joao Silva");
registerForm.setField("email", "joao@aluno.unb.br");
registerForm.setField("enrollment", "12345678");
registerForm.setField("password", "senha123");
registerForm.setField("confirmPassword", "senha123");
registerForm.setField("enrollmentProof", mockFile);
registerForm.submit();
console.log("");

console.log("--- TESTE 6: Cadastro com email nao institucional ---");
const registerForm2 = new RegisterForm(mediator);
mediator.setRegisterForm(registerForm2);
registerForm2.setField("name", "Maria Santos");
registerForm2.setField("email", "maria@gmail.com");
registerForm2.setField("enrollment", "12345678");
registerForm2.setField("password", "senha123");
registerForm2.setField("confirmPassword", "senha123");
registerForm2.setField("enrollmentProof", mockFile);
registerForm2.submit();
console.log("");

console.log("--- TESTE 7: Cadastro com senhas diferentes ---");
const registerForm3 = new RegisterForm(mediator);
mediator.setRegisterForm(registerForm3);
registerForm3.setField("name", "Pedro Costa");
registerForm3.setField("email", "pedro@unb.br");
registerForm3.setField("enrollment", "12345678");
registerForm3.setField("password", "senha123");
registerForm3.setField("confirmPassword", "senha456");
registerForm3.setField("enrollmentProof", mockFile);
registerForm3.submit();
console.log("");

console.log("--- TESTE 8: Cadastro sem comprovante ---");
const registerForm4 = new RegisterForm(mediator);
mediator.setRegisterForm(registerForm4);
registerForm4.setField("name", "Ana Lima");
registerForm4.setField("email", "ana@aluno.unb.br");
registerForm4.setField("enrollment", "12345678");
registerForm4.setField("password", "senha123");
registerForm4.setField("confirmPassword", "senha123");
registerForm4.submit();
console.log("");

console.log("--- TESTE 9: Cadastro com foto de perfil opcional ---");
const mockPhoto = new File(["foto"], "perfil.jpg", { type: "image/jpeg" });
const registerForm5 = new RegisterForm(mediator);
mediator.setRegisterForm(registerForm5);
registerForm5.setField("name", "Carlos Souza");
registerForm5.setField("email", "carlos@unb.br");
registerForm5.setField("enrollment", "12345678");
registerForm5.setField("password", "senha123");
registerForm5.setField("confirmPassword", "senha123");
registerForm5.setField("profilePhoto", mockPhoto);
registerForm5.setField("enrollmentProof", mockFile);
registerForm5.submit();
console.log("");

console.log("--- TESTE 10: Cadastro com matricula curta ---");
const registerForm6 = new RegisterForm(mediator);
mediator.setRegisterForm(registerForm6);
registerForm6.setField("name", "Lucia Ferreira");
registerForm6.setField("email", "lucia@aluno.unb.br");
registerForm6.setField("enrollment", "123");
registerForm6.setField("password", "senha123");
registerForm6.setField("confirmPassword", "senha123");
registerForm6.setField("enrollmentProof", mockFile);
registerForm6.submit();
console.log("");

console.log("--- TESTE 11: Cadastro com nome curto ---");
const registerForm7 = new RegisterForm(mediator);
mediator.setRegisterForm(registerForm7);
registerForm7.setField("name", "Jo");
registerForm7.setField("email", "jo@unb.br");
registerForm7.setField("enrollment", "12345678");
registerForm7.setField("password", "senha123");
registerForm7.setField("confirmPassword", "senha123");
registerForm7.setField("enrollmentProof", mockFile);
registerForm7.submit();
console.log("");

console.log("=== TESTES CONCLUIDOS ===");
```
</details>

## **7. Como Executar a Implementação**

### 7.1. Passos para Execução

**7.1.1. Clonar o repositório**

Abra o terminal e execute:

```bash
git clone https://github.com/UnBArqDsw2025-2-Turma02/2025.2_T02_G6_AquiTemFCTE_Entrega_03.git
```

**7.1.2. Acessar o diretório do projeto**

```bash
cd 2025.2_T02_G6_AquiTemFCTE_Entrega_03

cd GOFs/Comportamental/GOFMediator
```

**7.1.3. Instalar as dependências e rodar os testes**

```bash
npm install 
npm test
```

## **8. Senso Crítico e Trabalho em Equipe**

A implementação do padrão **Mediator** no projeto AquiTemFCTE demonstrou a aplicação de **senso crítico** e **trabalho em equipe** no desenvolvimento de soluções para redução de dependências caóticas entre objetos.

Em relação ao senso crítico, foi essencial o entendimento da função do GoF em questão para que, assim, fosse possível a aplicação do mesmo no projeto. Os integrantes responsáveis buscaram, com a implementação, restringir comunicações diretas entre objetos, os forçando a colaborarem apenas através do objeto mediador, facilitando a organização.

Quanto ao trabalho em equipe, ambos os membros, além de se comunicarem com constância, puderam compreender o local no projeto com maior necessidade de aplicação do padrão, buscando implementá-lo de forma coletiva, favorecendo, dessa forma, a troca de conhecimentos e o aprendizado mútuo.

## **9. Conclusão**

Em conclusão, a aplicação do padrão **Mediator** no projeto AquiTemFCTE demonstrou a importância de uma comunicação centralizada e desacoplada entre os componentes do sistema. Por meio do Mediator, foi possível organizar a troca de informações entre diferentes partes do sistema — como validações, formulários e fluxos de autenticação — sem que os objetos precisassem se referir diretamente uns aos outros.

Essa abordagem reforçou conceitos fundamentais de baixo acoplamento, alta coesão e responsabilidade única, pilares do design orientado a objetos e dos princípios SOLID. A atividade consolidou o entendimento do padrão Mediator e evidenciou sua aplicabilidade prática em cenários reais de desenvolvimento, contribuindo significativamente para a maturidade técnica e colaborativa da equipe.

## **10. Referências**

> SERRANO, Milene, Arquitetura e Desenho de Software - Aula - GOFS COMPORTAMENTAIS. Disponível em: https://aprender3.unb.br/pluginfile.php/3178544/mod_page/content/1/Arquitetura%20e%20Desenho%20de%20Software%20-%20Aula%20GoFs%20Estruturais%20-%20Profa.%20Milene.pdf. Universidade de Brasília - UnB. Brasília. Acesso em 23 de outubro de 2025.

> REFACTORING GURU. Padrão de Projeto Mediator. Disponível em: https://refactoring.guru/pt-br/design-patterns/mediator. Acesso em: 23 de outubro de 2025.

## Histórico de Versões
| Versão | Data | Descrição | Autor(es) | Revisor(es) | Detalhes da Revisão |
| -- | -- | -- | -- | -- | -- |
| 1.0 | 23/10/2025 | Desenvolvimento inicial da documentação do Mediator | [Lucas Guimarães](https://github.com/lcsgborges) | [Davi Camilo](https://github.com/Davicamilo23) | Foi encontrado um erro na formatação do tópico 8 |
| 1.1 | 23/10/2025 | Adição do Diagrama do Mediator | [Davi Camilo](https://github.com/Davicamilo23) | [Lucas Guimarães](https://github.com/lcsgborges) | O diagrama colocado no documento não é o da classe correta |
| 1.2 | 23/10/2025 | Atualização do Diagrama do Mediator, adição de mais informações na Introdução e na Metodologia e atualização do Senso Crítico e Trabalho em Equipe e das Referências | [Davi Camilo](https://github.com/Davicamilo23) | [Lucas Guimarães](https://github.com/lcsgborges) | Diagrama e códigos condizentes agora com o padrão proposto pelo Mediator  |
| 1.3 | 23/10/2025 | Adição dos códigos e vídeo | [Lucas Guimarães](https://github.com/lcsgborges) | [Davi Camilo](https://github.com/Davicamilo23) | Sem erros encontrados |
